<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Rust Collections - joe</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Joe"><meta name=description content="Rustä¸­çš„é›†åˆç±»å‹ Rustçš„æ ‡å‡†åº“ä¸­æä¾›äº†å¸¸ç”¨çš„é›†åˆç±»å‹ï¼šVect(ç›¸å½“äºJavaä¸­çš„List)ï¼ŒMap(ç›¸å½“äºJavaä¸­çš„Map)ï¼Œåœ¨ä½¿"><meta name=keywords content="Joe,blog,go,rust,java"><meta name=generator content="Hugo 0.79.1 with theme even"><link rel=canonical href=https://holicc.github.io/post/rust/rust-collections/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.d5f8d5189df9f67f1828dcc61b07c33fcd84dbb87a9d0036891d742acf5ef7ac.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Rust Collections"><meta property="og:description" content="Rustä¸­çš„é›†åˆç±»å‹ Rustçš„æ ‡å‡†åº“ä¸­æä¾›äº†å¸¸ç”¨çš„é›†åˆç±»å‹ï¼šVect(ç›¸å½“äºJavaä¸­çš„List)ï¼ŒMap(ç›¸å½“äºJavaä¸­çš„Map)ï¼Œåœ¨ä½¿"><meta property="og:type" content="article"><meta property="og:url" content="https://holicc.github.io/post/rust/rust-collections/"><meta property="article:published_time" content="2020-07-15T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-15T00:00:00+00:00"><meta itemprop=name content="Rust Collections"><meta itemprop=description content="Rustä¸­çš„é›†åˆç±»å‹ Rustçš„æ ‡å‡†åº“ä¸­æä¾›äº†å¸¸ç”¨çš„é›†åˆç±»å‹ï¼šVect(ç›¸å½“äºJavaä¸­çš„List)ï¼ŒMap(ç›¸å½“äºJavaä¸­çš„Map)ï¼Œåœ¨ä½¿"><meta itemprop=datePublished content="2020-07-15T00:00:00+00:00"><meta itemprop=dateModified content="2020-07-15T00:00:00+00:00"><meta itemprop=wordCount content="1711"><meta itemprop=keywords content="programing,rust,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Collections"><meta name=twitter:description content="Rustä¸­çš„é›†åˆç±»å‹ Rustçš„æ ‡å‡†åº“ä¸­æä¾›äº†å¸¸ç”¨çš„é›†åˆç±»å‹ï¼šVect(ç›¸å½“äºJavaä¸­çš„List)ï¼ŒMap(ç›¸å½“äºJavaä¸­çš„Map)ï¼Œåœ¨ä½¿"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Joe</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Joe</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Rust Collections</h1><div class=post-meta><span class=post-time>2020-07-15</span><div class=post-category><a href=/categories/programing/>programing</a></div><span class=more-meta>1711 words</span>
<span class=more-meta>4 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"></div></div><div class=post-content><h3 id=rustä¸­çš„é›†åˆç±»å‹>Rustä¸­çš„é›†åˆç±»å‹</h3><p>Rustçš„æ ‡å‡†åº“ä¸­æä¾›äº†å¸¸ç”¨çš„é›†åˆç±»å‹ï¼š<code>Vect</code>(ç›¸å½“äºJavaä¸­çš„List)ï¼Œ<code>Map</code>(ç›¸å½“äºJavaä¸­çš„Map)ï¼Œåœ¨ä½¿ç”¨è¿™äº›é›†åˆçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„çš„æ˜¯
<code>Ownership</code>å’Œ<code>let & let mut</code>çš„ä¸€äº›æ³¨æ„äº‹é¡¹</p><p>ä½¿ç”¨<code>Vect</code>ç›´æ¥ä½¿ç”¨å‡½æ•°åˆ›å»ºæˆ–è€…ä½¿ç”¨å®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=kd>let</span><span class=w> </span><span class=n>v</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>i32</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=c1>//let c = Vec![1,2,3,4];
</span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°Vecæ˜¯ä¸€ä¸ªæ”¯æŒæ³›å‹çš„é›†åˆç±»å‹ï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™éœ€è¦æŒ‡å®šå…¶å†…éƒ¨å…ƒç´ çš„å…·ä½“ç±»å‹ï¼›</p><p>ä½¿ç”¨<code>mut</code>å®šä¹‰Vectorå°±å¯ä»¥å¯¹å®ƒè¿›è¡Œä¿®æ”¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span><span class=w>
</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span><span class=w>
</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=mi>7</span><span class=p>);</span><span class=w>
</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>å½“ç„¶äº†æ ¹æ®ä»»ä½•å˜é‡éƒ½æœ‰å…¶ä½œç”¨åŸŸï¼ˆScopeï¼‰å¦‚æœä¸åœ¨ä½œç”¨åŸŸä¸­äº†å°±ä¼šè¢«é‡Šæ”¾æ‰ï¼Œå¹¶ä¸”Vectorä¸­çš„å…ƒç´ ä¹Ÿä¼šç›¸åº”çš„è¢«é‡Šæ”¾æ‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vec</span><span class=o>!</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>];</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=c1>// do stuff with v
</span><span class=c1></span><span class=p>}</span><span class=w> </span><span class=c1>// &lt;- v goes out of scope and is freed here
</span></code></pre></td></tr></table></div></div><p>rustä¸­è®¿é—®Vectorå…ƒç´ æœ‰ä¸¤ç§æ–¹æ³•ä¸€ç§æ˜¯ä½¿ç”¨ä¸‹æ ‡è®¿é—®ä¸€ç§æ˜¯ä½¿ç”¨getæ–¹æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vec</span><span class=o>!</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>];</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>third</span>: <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;The third element is {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>third</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=nb>Some</span><span class=p>(</span><span class=n>third</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;The third element is {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>third</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;There is no third element.&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>åŒºåˆ«åœ¨äºgetæ–¹æ³•æ˜¯ç©ºå®‰å…¨çš„ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª<code>Option&lt;&T></code>ç±»å‹ï¼Œå°±æ˜¯è¯´å¦‚æœgetçš„ä¸€ä¸ªä¸å­˜åœ¨vectorä¸­çš„å…ƒç´ åªä¼šè¿”å›ä¸€ä¸ª<code>Option&lt;None></code>,è€Œä½¿ç”¨<br><code>&[]</code>ä¸‹æ ‡è®¿é—®ä¼španicï¼Œå› ä¸ºä½ è®¿é—®äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ ï¼›</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vec</span><span class=o>!</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>];</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>v</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;The first element is: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>first</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>ä¸ºä»€ä¹ˆä»¥ä¸Šä»£ç æ— æ³•ç¼–è¯‘é€šè¿‡ï¼Œå¯ä»¥è¯´æ˜¯å……æ»¡äº†Rustçš„å“²å­¦ğŸ˜‚</p><blockquote><p>This error is due to the way vectors work: adding a new element onto the end of the vector might require allocating new memory and copying the old elements to the new space, if there isnâ€™t enough room to put all the elements next to each other where the vector currently is. In that case, the reference to the first element would be pointing to deallocated memory. The borrowing rules prevent programs from ending up in that situation.</p></blockquote><p>å®˜æ–¹è§£é‡Šè¯´è¿™è·ŸVectorçš„å®ç°æœºåˆ¶æœ‰å…³ï¼Œåœ¨å¾€Vectorä¸­æ·»åŠ æ–°çš„å…ƒç´ çš„æ—¶å€™å¯èƒ½ä¼šå› ä¸ºåŸå§‹ç©ºé—´ä¸å¤Ÿå®¹çº³è¿™ä¹ˆå¤šå…ƒç´ è€Œå¯¼è‡´å°†åŸæ¥çš„å…ƒç´ éƒ½æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„åœ°æ–¹ï¼Œä»è€Œæ”¹å˜äº†å†…éƒ¨å…ƒç´ çš„æŒ‡é’ˆï¼Œå¦‚æœè¿™æ—¶æœ‰ä¸€ä¸ªå¤–éƒ¨å€Ÿç”¨çš„æŒ‡é’ˆè¿˜åœç•™åœ¨åŸå§‹çš„æœªçŸ¥å°±ä¼šé€ æˆå†…å­˜è®¿é—®ä¸æ­£ç¡®çš„é—®é¢˜ã€‚</p><p>è¿­ä»£æ–¹å¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vec</span><span class=o>!</span><span class=p>[</span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=mi>32</span><span class=p>,</span><span class=w> </span><span class=mi>57</span><span class=p>];</span><span class=w>
</span><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>&amp;</span><span class=n>v</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=o>*</span><span class=n>i</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>50</span><span class=p>;</span><span class=w> </span><span class=c1>//* è¡¨ç¤ºè§£å¼•ç”¨
</span><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>å®˜æ–¹æ–‡æ¡£ä¹Ÿè®²äº†ä¸€äº›Vectorçš„ä¸€äº›æŠ€å·§</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>enum</span> <span class=nc>SpreadsheetCell</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Int</span><span class=p>(</span><span class=kt>i32</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Float</span><span class=p>(</span><span class=kt>f64</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Text</span><span class=p>(</span><span class=nb>String</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>row</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vec</span><span class=o>!</span><span class=p>[</span><span class=w>
</span><span class=w>        </span><span class=n>SpreadsheetCell</span>::<span class=n>Int</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>SpreadsheetCell</span>::<span class=n>Text</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;blue&#34;</span><span class=p>)),</span><span class=w>
</span><span class=w>        </span><span class=n>SpreadsheetCell</span>::<span class=n>Float</span><span class=p>(</span><span class=mf>10.12</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>];</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>åœ¨Rustä¸­Stringä¹Ÿä½¿ç”¨é›†åˆç±»å‹å®ç°çš„ï¼Œåº•å±‚å°±æ˜¯ä¸€ä¸ªbytesé›†åˆï¼Œæ‰€ä»¥å®˜æ–¹ä¹Ÿæ”¾åˆ°äº†è¿™ä¸€ç« èŠ‚æ¥è®²ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;foo&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>s</span><span class=p>.</span><span class=n>push_str</span><span class=p>(</span><span class=s>&#34;bar&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>å¯¹äºå¦‚ä½•åœ¨Stringä¸­ä½¿ç”¨<code>+</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸€é—¨å­¦é—®</p><blockquote><p>This isnâ€™t the exact signature thatâ€™s in the standard library: in the standard library, add is defined using generics. Here, weâ€™re looking at the signature of add with concrete types substituted for the generic ones, which is what happens when we call this method with String values. Weâ€™ll discuss generics in Chapter 10. This signature gives us the clues we need to understand the tricky bits of the + operator.</p><p>First, s2 has an &, meaning that weâ€™re adding a reference of the second string to the first string because of the s parameter in the add function: we can only add a &str to a String; we canâ€™t add two String values together. But waitâ€”the type of &s2 is &String, not &str, as specified in the second parameter to add. So why does Listing 8-18 compile?</p><p>The reason weâ€™re able to use &s2 in the call to add is that the compiler can coerce the &String argument into a &str. When we call the add method, Rust uses a deref coercion, which here turns &s2 into &s2[..]. Weâ€™ll discuss deref coercion in more depth in Chapter 15. Because add does not take ownership of the s parameter, s2 will still be a valid String after this operation.</p><p>Second, we can see in the signature that add takes ownership of self, because self does not have an &. This means s1 in Listing 8-18 will be moved into the add call and no longer be valid after that. So although let s3 = s1 +  looks like it will copy both strings and create a new one, this statement actually takes ownership of s1, appends a copy of the contents of s2, and then returns ownership of the result. In other words, it looks like itâ€™s making a lot of copies but isnâ€™t; the implementation is more efficient than copying.</p></blockquote><p>å®˜æ–¹ç”¨äº†å¾ˆé•¿ä¸€æ®µæ¥è¯´æ˜å¦‚ä½•å¯¹Stringç±»å‹æ¥ä½¿ç”¨<code>+</code>å·ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯<code>+</code>å…¶å®æ˜¯å°±æ˜¯Stringçš„addæ–¹æ³•</p><p>çœ‹ä¸€ä¸‹æ–¹æ³•ç­¾å</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>String</span> 
</code></pre></td></tr></table></div></div><p>æ¥å—çš„å¯¹è±¡æ˜¯ä¸€ä¸ª<code>&str</code>,æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥æ˜¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=kd>let</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;zxc&#34;</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>ä¹Ÿå¯ä»¥æ˜¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=kd>let</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=o>&amp;</span><span class=n>b</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>è¿™é‡Œçš„<code>&b</code>æ˜¯ä¸€ä¸ª<code>&String</code>ä¼šè¢«å¼ºè½¬ä¸ºä¸€ä¸ª <code>&str</code>ç±»å‹ã€‚</p><p>Stringç±»å‹ä¹Ÿä¸æ”¯æŒä¸‹æ ‡è®¿é—®ï¼Œï¼ˆå¯¹Javaç¨‹åºå‘˜æ¥è¯´å¾ˆOKï¼‰</p><p>æœ€åå®˜æ–¹è¯´äº†ä¸€å¥è®©äººæ— è¯­çš„è¯</p><blockquote><p>To summarize, strings are complicated. Different programming languages make different choices about how to present this complexity to the programmer. Rust has chosen to make the correct handling of String data the default behavior for all Rust programs, which means programmers have to put more thought into handling UTF-8 data upfront. This trade-off exposes more of the complexity of strings than is apparent in other programming languages, but it prevents you from having to handle errors involving non-ASCII characters later in your development life cycle.</p></blockquote><p>å¥½å§ï¼Œä¸‹ä¸€ä¸ªæ˜¯HashMap</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>scores</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HashMap</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Blue&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Yellow&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>50</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>å¯¹äºéæ‹·è´çš„å€¼ä¾‹å¦‚Stringç±»å‹ï¼Œå¦‚æœæŠŠå€¼insertåˆ°mapä¸­å°±æ˜¯å¯¹è¿™ä¸ªå€¼æ‰€æœ‰æƒçš„è½¬ç§»åˆ°mapä¸­äº†ï¼›</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>field_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Favorite color&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>field_value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Blue&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HashMap</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=n>map</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>field_name</span><span class=p>,</span><span class=w> </span><span class=n>field_value</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=c1>// field_name and field_value are invalid at this point, try using them and
</span><span class=c1></span><span class=w>    </span><span class=c1>// see what compiler error you get!
</span><span class=c1></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>å¦‚ä½•è¿­ä»£ï¼Œå¾ˆå¥½ç†è§£</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>scores</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HashMap</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Blue&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Yellow&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>50</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>&amp;</span><span class=n>scores</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>ä¸€äº›apiä»‹ç»</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>scores</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HashMap</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Blue&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Yellow&#34;</span><span class=p>)).</span><span class=n>or_insert</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>scores</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Blue&#34;</span><span class=p>)).</span><span class=n>or_insert</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>scores</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>ç›¸å½“äºJavaä¸­çš„<code>map.putIfAbsent</code></p><p>å…¶ä»–çš„å°±ä¸èµ˜è¿°äº†ï¼Œå°±æ˜¯äº†è§£ä¸€ä¸‹Rustä¸­çš„é›†åˆ</p><p>å®Œï¼</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Joe</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-07-15</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/programing/>programing</a>
<a href=/tags/rust/>rust</a></div><nav class=post-nav><a class=prev href=/post/rust/rust-error/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Rust Error</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/java/rocketmq-overstock/><span class="next-text nav-default">RocketMQ</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:longshanluu@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/holicc/holicc class="iconfont icon-github" title=github></a><a href=https://holicc.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2020<span class=heart><i class="iconfont icon-heart"></i></span><span>Joe</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157580785-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>