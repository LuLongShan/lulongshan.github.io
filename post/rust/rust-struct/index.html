<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Rust Struct - joe</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Joe"><meta name=description content="通过使用关键struct可以定义一个类，呸，是定义一个结构体。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 struct User{username: String,email: String,sign_in_count: u64,active: bool,}fn main(){letuser1=User{email: String::from(&amp;#34;someone@example.com&amp;#34;),username: String::from(&amp;#34;someusername123&amp;#34;),active: true,sign_in_count: 1,};} struct与Java中的类"><meta name=keywords content="Joe,blog,go,rust,java"><meta name=generator content="Hugo 0.79.1 with theme even"><link rel=canonical href=https://holicc.github.io/post/rust/rust-struct/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.d5f8d5189df9f67f1828dcc61b07c33fcd84dbb87a9d0036891d742acf5ef7ac.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Rust Struct"><meta property="og:description" content="通过使用关键struct可以定义一个类，呸，是定义一个结构体。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 struct User{username: String,email: String,sign_in_count: u64,active: bool,}fn main(){letuser1=User{email: String::from(&#34;someone@example.com&#34;),username: String::from(&#34;someusername123&#34;),active: true,sign_in_count: 1,};} struct与Java中的类"><meta property="og:type" content="article"><meta property="og:url" content="https://holicc.github.io/post/rust/rust-struct/"><meta property="article:published_time" content="2020-07-08T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-08T00:00:00+00:00"><meta itemprop=name content="Rust Struct"><meta itemprop=description content="通过使用关键struct可以定义一个类，呸，是定义一个结构体。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 struct User{username: String,email: String,sign_in_count: u64,active: bool,}fn main(){letuser1=User{email: String::from(&#34;someone@example.com&#34;),username: String::from(&#34;someusername123&#34;),active: true,sign_in_count: 1,};} struct与Java中的类"><meta itemprop=datePublished content="2020-07-08T00:00:00+00:00"><meta itemprop=dateModified content="2020-07-08T00:00:00+00:00"><meta itemprop=wordCount content="1199"><meta itemprop=keywords content="programing,rust,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Struct"><meta name=twitter:description content="通过使用关键struct可以定义一个类，呸，是定义一个结构体。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 struct User{username: String,email: String,sign_in_count: u64,active: bool,}fn main(){letuser1=User{email: String::from(&#34;someone@example.com&#34;),username: String::from(&#34;someusername123&#34;),active: true,sign_in_count: 1,};} struct与Java中的类"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Joe</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Joe</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Rust Struct</h1><div class=post-meta><span class=post-time>2020-07-08</span><div class=post-category><a href=/categories/programing/>programing</a></div><span class=more-meta>1199 words</span>
<span class=more-meta>3 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"></div></div><div class=post-content><p>通过使用关键<code>struct</code>可以定义一个类，呸，是定义一个结构体。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>struct</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>username</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>email</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>sign_in_count</span>: <span class=kt>u64</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>active</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>email</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;someone@example.com&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>username</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;someusername123&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>active</span>: <span class=nc>true</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>sign_in_count</span>: <span class=mi>1</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p><code>struct</code>与Java中的类是不同的两种数据结构，具体的使用方式也有所不同。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>build_user</span><span class=p>(</span><span class=n>email</span>: <span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>username</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>email</span>: <span class=nc>email</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>username</span>: <span class=nc>username</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>active</span>: <span class=nc>true</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>sign_in_count</span>: <span class=mi>1</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>有一个算是语法糖的功能就是,结构体复用;使用<code>..</code>符号能够复用一个已经创建好的结构中的字段;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>struct</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>username</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>email</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>sign_in_count</span>: <span class=kt>u64</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>active</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>email</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;someone@example.com&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>username</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;someusername123&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>active</span>: <span class=nc>true</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>sign_in_count</span>: <span class=mi>1</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>email</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;another@example.com&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>username</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;anotherusername567&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=p>..</span><span class=n>user1</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>也可以定义一种类似Java中<code>Record</code>的数据结构</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>struct</span> <span class=nc>Color</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=k>struct</span> <span class=nc>Point</span><span class=p>(</span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w> </span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>black</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Color</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>     
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>origin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Point</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>看起来虽然跟Golang没什么太大的区别,但是加上了所有权之后就有了一些限制;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>struct</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>username</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>email</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>sign_in_count</span>: <span class=kt>u64</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>active</span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>email</span>: <span class=s>&#34;someone@example.com&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>username</span>: <span class=s>&#34;someusername123&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>active</span>: <span class=nc>true</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>sign_in_count</span>: <span class=mi>1</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>     
</span></code></pre></td></tr></table></div></div><p>这是Rust团队深思熟虑过后的设计,为了能够让struct的实例能够拥有成员变量的所有权</p><blockquote><p>In the User struct definition in Listing 5-1, we used the owned String type rather than the &str string slice type. This is a deliberate choice because we want instances of this struct to own all of its data and for that data to be valid for as long as the entire struct is valid.</p></blockquote><p>不懂的是为什么这里username使用了<code>&str</code>就没有了username成员变量的所有权?</p><p>难道是因为<code>&str</code>是一个<code>slice</code>类型? slice就是一中没有所有权的数据类型.</p><blockquote><p>Another data type that does not have ownership is the slice</p></blockquote><p>好像是这样的,可以的,Rust强(吹)!</p><p>想要像在Java中一样自由的打印对象,需要在struct上进行一些特殊处理,相当于需要实现一个<code>toString()</code>方法一样.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Debug)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>width</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>height</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rect1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>width</span>: <span class=mi>30</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>height</span>: <span class=mi>50</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;rect1 is {:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>rect1</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>由于Rust是一门拥有面向对象和函数编程的语言，所以在Rust中可以对<code>struct</code>对象定义所属的方法
其中使用了<code>impl</code>和<code>self</code>关键字，语义上还是能够理解的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Debug)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>width</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>height</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>area</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>u32</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>height</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rect1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>width</span>: <span class=mi>30</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>height</span>: <span class=mi>50</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=w>
</span><span class=w>        </span><span class=s>&#34;The area of the rectangle is {} square pixels.&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>rect1</span><span class=p>.</span><span class=n>area</span><span class=p>()</span><span class=w>
</span><span class=w>    </span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>本来以为挺简单的，但是结合上了所有权系统一切都变得复杂了；</p><blockquote><p>We’ve chosen &self here for the same reason we used &Rectangle in the function version: we don’t want to take ownership, and we just want to read the data in the struct, not write to it. If we wanted to change the instance that we’ve called the method on as part of what the method does, we’d use &mut self as the first parameter. Having a method that takes ownership of the instance by using just self as the first parameter is rare; this technique is usually used when the method transforms self into something else and you want to prevent the caller from using the original instance after the transformation.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>area</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>u32</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>height</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>这个方法始终保持了类型函数的意思,这里的<code>self</code>其实就是函数中的<code>Rectangle</code>相当于<strong>move</strong> ，加上<code>&</code>后就是<strong>Borrowing</strong>。当方法需要修改struct实例的中的属性的时候就需要使用<code>&mut self</code>,当需要所有权移交的时候就使用<code>self</code>;</p><p>原来如此，也没有想象的那么复杂（可能吧）。</p><p>把函数放到<strong>Impl</strong>块中叫做<strong>关联函数</strong><code>associated functions</code>相当于Java中的静态方法,通过struct直接调用,就像<code>String::from()</code></p><p>Rust也允许定义对同一个struct多个<strong>Impl</strong>块</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Debug)]</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>width</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>height</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>area</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>u32</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>height</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>can_hold</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>other</span>: <span class=kp>&amp;</span><span class=nc>Rectangle</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>other</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>height</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>other</span><span class=p>.</span><span class=n>height</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rect1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>width</span>: <span class=mi>30</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>height</span>: <span class=mi>50</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rect2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>width</span>: <span class=mi>10</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>height</span>: <span class=mi>40</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rect3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>width</span>: <span class=mi>60</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>height</span>: <span class=mi>45</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;Can rect1 hold rect2? {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>rect1</span><span class=p>.</span><span class=n>can_hold</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rect2</span><span class=p>));</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;Can rect1 hold rect3? {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>rect1</span><span class=p>.</span><span class=n>can_hold</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rect3</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>完!</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Joe</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-07-08</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/programing/>programing</a>
<a href=/tags/rust/>rust</a></div><nav class=post-nav><a class=prev href=/post/rust/rust-enums-and-patter-match/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Rust Enums And Patter Match</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/rust/rust-references-and-borrowing/><span class="next-text nav-default">Rust Reference And Borrowing</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:longshanluu@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/holicc/holicc class="iconfont icon-github" title=github></a><a href=https://holicc.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2020<span class=heart><i class="iconfont icon-heart"></i></span><span>Joe</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],}};</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157580785-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>