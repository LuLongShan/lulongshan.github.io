<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Rust Reference And Borrowing - joe</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Joe"><meta name=description content="Rustä¸­çš„å¼•ç”¨(Reference)ä¸å€Ÿç”¨(Borrowing) åœ¨ä¸Šä¸€èŠ‚çš„æ‰€æœ‰æƒç³»ç»Ÿçš„æœ€åï¼Œå®˜æ–¹æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å‡½æ•°ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ"><meta name=keywords content="Joe,blog,go,rust,java"><meta name=google-site-verification content="p57kqoESmZ0ynxO7X7LZItfNnw9_EVutfBG_kntGzhs"><meta name=generator content="Hugo 0.84.1 with theme even"><link rel=canonical href=https://holicc.github.io/post/rust/rust-references-and-borrowing/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script data-ad-client=ca-pub-7877604046340220 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link href=/sass/main.min.d5f8d5189df9f67f1828dcc61b07c33fcd84dbb87a9d0036891d742acf5ef7ac.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Rust Reference And Borrowing"><meta property="og:description" content="Rustä¸­çš„å¼•ç”¨(Reference)ä¸å€Ÿç”¨(Borrowing) åœ¨ä¸Šä¸€èŠ‚çš„æ‰€æœ‰æƒç³»ç»Ÿçš„æœ€åï¼Œå®˜æ–¹æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å‡½æ•°ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ"><meta property="og:type" content="article"><meta property="og:url" content="https://holicc.github.io/post/rust/rust-references-and-borrowing/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-07-07T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-07T00:00:00+00:00"><meta itemprop=name content="Rust Reference And Borrowing"><meta itemprop=description content="Rustä¸­çš„å¼•ç”¨(Reference)ä¸å€Ÿç”¨(Borrowing) åœ¨ä¸Šä¸€èŠ‚çš„æ‰€æœ‰æƒç³»ç»Ÿçš„æœ€åï¼Œå®˜æ–¹æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å‡½æ•°ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ"><meta itemprop=datePublished content="2020-07-07T00:00:00+00:00"><meta itemprop=dateModified content="2020-07-07T00:00:00+00:00"><meta itemprop=wordCount content="1260"><meta itemprop=keywords content="programing,rust,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Reference And Borrowing"><meta name=twitter:description content="Rustä¸­çš„å¼•ç”¨(Reference)ä¸å€Ÿç”¨(Borrowing) åœ¨ä¸Šä¸€èŠ‚çš„æ‰€æœ‰æƒç³»ç»Ÿçš„æœ€åï¼Œå®˜æ–¹æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å‡½æ•°ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Joe</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Joe</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Rust Reference And Borrowing</h1><div class=post-meta><span class=post-time>2020-07-07</span><div class=post-category><a href=/categories/programing/>programing</a></div><span class=more-meta>1260 words</span>
<span class=more-meta>3 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"></div></div><div class=post-content><h3 id=rustä¸­çš„å¼•ç”¨referenceä¸å€Ÿç”¨borrowing>Rustä¸­çš„å¼•ç”¨(Reference)ä¸å€Ÿç”¨(Borrowing)</h3><p>åœ¨ä¸Šä¸€èŠ‚çš„æ‰€æœ‰æƒç³»ç»Ÿçš„æœ€åï¼Œå®˜æ–¹æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å‡½æ•°ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœæŠŠå‚æ•°ä¼ è¿›å»å°±æŠŠæ‰€æœ‰æƒç§»äº¤åˆ°äº†å‡½æ•°ä¸­ï¼Œé‚£ä¹ˆåç»­åˆå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç§»äº¤æ‰€æœ‰æƒåçš„å˜é‡å‘¢ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=p>(</span><span class=n>s2</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calculate_length</span><span class=p>(</span><span class=n>s1</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;The length of &#39;{}&#39; is {}.&#34;</span><span class=p>,</span><span class=w> </span><span class=n>s2</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>calculate_length</span><span class=p>(</span><span class=n>s</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=p>(</span><span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=kt>usize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>len</span><span class=p>();</span><span class=w> </span><span class=c1>// len() returns the length of a String
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>å®˜æ–¹ç»™å‡ºçš„ä»£ç å¦‚ä¸Šï¼Œä½†æ˜¯è¿™æ ·å†™å°±å¤ªç¹çäº†ã€‚</p><p>æœ¬èŠ‚å°±æ˜¯è®²å¦‚ä½•ä½¿ç”¨<code>Reference</code>å’Œ<code>Borrorwing</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å…ˆæ¥ä¸€æ®µä»£ç èµ·æ‰‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calculate_length</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s1</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;The length of &#39;{}&#39; is {}.&#34;</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>calculate_length</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>usize</span> <span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>s</span><span class=p>.</span><span class=n>len</span><span class=p>()</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ç†è§£çš„æ˜¯ä¼ é€’çš„æ˜¯<code>s1</code>å˜é‡çš„æŒ‡é’ˆï¼Œæ‰€æœ‰<code>s1</code>å˜é‡çš„æ‰€æœ‰æƒæ²¡æœ‰ç§»äº¤å‡ºå»ã€‚</p><p><code>&</code>è¿™ä¸ªç¬¦å·ï¼Œè®°å¾—åœ¨Cè¯­è¨€ä¸­æ˜¯<strong>å–åœ°å€</strong>çš„æ„æ€ã€‚</p><blockquote><p>The &s1 syntax lets us create a reference that refers to the value of s1 but does not own it. Because it does not own it, the value it points to will not be dropped when the reference goes out of scope.</p></blockquote><p>åœ¨Rustä¸­è¿™æ ·ä½¿ç”¨<strong>å¼•ç”¨</strong>çš„æ–¹å¼å«åš<code>Borrowing</code>å€Ÿç”¨,è¿™ç§æ–¹å¼å…è®¸è·å–ä¸€ä¸ªå€¼çš„å¼•ç”¨è€Œä¸ç”¨ç§»äº¤æ‰€æœ‰æƒ,å› ä¸ºä½ å§‹ç»ˆæ˜¯ä¸œè¥¿çš„ä¸»äººï¼Œåˆ«äººåªæ˜¯å€Ÿç”¨äº†ä½ çš„ä¸œè¥¿ã€‚</p><blockquote><p>We call having references as function parameters borrowing. As in real life, if a person owns something, you can borrow it from them. When youâ€™re done, you have to give it back.</p></blockquote><p>é‚£ä¹ˆå°±æœ‰ä¸ªé—®é¢˜ï¼Œåˆ«äººå€Ÿçš„ä¸œè¥¿<em>â€˜å¼„åäº†æ€ä¹ˆåŠï¼Ÿâ€™</em></p><p>ä¸€ä¸‹ä»£ç ä¸èƒ½ç¼–è¯‘é€šè¿‡æ˜¯å› ä¸ºæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹åˆ«äººçš„ä¸œè¥¿ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>change</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>change</span><span class=p>(</span><span class=n>some_string</span>: <span class=kp>&amp;</span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>some_string</span><span class=p>.</span><span class=n>push_str</span><span class=p>(</span><span class=s>&#34;, world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>å¦‚æœå¼ºè¡Œä¿®æ”¹åˆ«äººçš„ä¸œè¥¿é‚£ä¹ˆå°±éœ€è¦è¿™æ ·å†™ï¼ˆç›¸å½“äºåœ¨ä¿®æ”¹åˆ«äººçš„ä¸œè¥¿æ—¶ï¼Œå…ˆé—®ä¸€å¥ï¼šâ€œæˆ‘å¯ä»¥ä¿®æ”¹ä½ çš„æ•°æ®å—ï¼Ÿâ€ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>change</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>change</span><span class=p>(</span><span class=n>some_string</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>some_string</span><span class=p>.</span><span class=n>push_str</span><span class=p>(</span><span class=s>&#34;, world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>ä½†æ˜¯å‘¢ï¼Œè¿™æ ·åˆæœ‰å¾ˆå¤šçš„é™åˆ¶ï¼Œä½ ä¸èƒ½æŠŠä¸œè¥¿å€Ÿç»™å¤šä¸ªæƒ³è¦ä¿®æ”¹çš„äººã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}, {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>,</span><span class=w> </span><span class=n>r2</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><blockquote><p>Data races cause undefined behavior and can be difficult to diagnose and fix when youâ€™re trying to track them down at runtime; Rust prevents this problem from happening because it wonâ€™t even compile code with data races!</p></blockquote><p>ä¸ºä»€ä¹ˆä¸è®¸å…è®¸åŒä¸€å¼•ç”¨çš„å¤šå‡ºä¿®æ”¹ï¼Œæ˜¯ä¸ºäº†é¿å…æ•°æ®ç«äº‰å¸¦æ¥çš„å„ç§ä¸å®‰å…¨çš„è¡Œä¸ºã€‚</p><p>ä¸€ç§æŠ˜ä¸­çš„å†™æ³•æ˜¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=c1>// r1 goes out of scope here, so we can make a new reference with no problems.
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>ä½†æ˜¯ä¸èƒ½é€šæ˜¯æŠŠä¸å¯å˜å¼•ç”¨å’Œå¯å˜å¼•ç”¨éƒ½å€Ÿå‡ºå»ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// no problem
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// no problem
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// BIG PROBLEM
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}, {}, and {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>,</span><span class=w> </span><span class=n>r2</span><span class=p>,</span><span class=w> </span><span class=n>r3</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>WTF?! æ‰“è„¸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// no problem
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// no problem
</span><span class=c1></span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{} and {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>r1</span><span class=p>,</span><span class=w> </span><span class=n>r2</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=c1>// r1 and r2 are no longer used after this point
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>r3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w> </span><span class=c1>// no problem
</span><span class=c1></span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>r3</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><blockquote><p>Note that a referenceâ€™s scope starts from where it is introduced and continues through the last time that reference is used. For instance, this code will compile because the last usage of the immutable references occurs before the mutable reference is introduced:</p></blockquote><p>å®˜æ–¹æ–‡æ¡£å‘Šè¯‰æˆ‘ï¼Œåªè¦ä¸å¯å˜çš„å¼•ç”¨è¢«ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå°±ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œåç»­å®šä¹‰çš„å¯å˜å¼•ç”¨<code>r3</code>å®šä¹‰å°±æ˜¯èƒ½å¤Ÿç¼–è¯‘é€šè¿‡çš„ã€‚</p><p>è¿™ä¸ªâ€œå¥‡æ€ªâ€çš„è®¾è®¡ï¼Œå®˜æ–¹ä¹Ÿç»™å‡ºäº†å®‰æ…°</p><blockquote><p>Even though borrowing errors may be frustrating at times, remember that itâ€™s the Rust compiler pointing out a potential bug early (at compile time rather than at runtime) and showing you exactly where the problem is. Then you donâ€™t have to track down why your data isnâ€™t what you thought it was.</p></blockquote><p>ç¼–è¯‘æ—¶æœŸå‘èƒ½å‘ç°çš„é—®é¢˜ï¼Œæ€»æ¯”è¿è¡Œæ—¶çš„å¼‚å¸¸å¥½å§ ğŸ˜‚ã€‚</p><p>ä¹‹å‰è¯´åˆ°ä¼šæŠŠâ€å€Ÿæ¥çš„ä¸œè¥¿ç©åâ€œï¼Œå°±æ˜¯ä¸€ä¸‹è¿™ç§æƒ…å†µï¼Œä¸“ä¸šæœ¯è¯­<code>dangle</code> <strong>æ‚¬å‚æŒ‡é’ˆ</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>reference_to_nothing</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dangle</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>dangle</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=c1>// dangle returns a reference to a String
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// s is a new String
</span><span class=c1></span><span class=w>
</span><span class=w>    </span><span class=o>&amp;</span><span class=n>s</span><span class=w> </span><span class=c1>// we return a reference to the String, s
</span><span class=c1></span><span class=p>}</span><span class=w> </span><span class=c1>// Here, s goes out of scope, and is dropped. Its memory goes away.
</span><span class=c1></span><span class=w>  </span><span class=c1>// Danger!
</span></code></pre></td></tr></table></div></div><p>å› ä¸ºæ˜¯å€Ÿç”¨æ¥çš„ä¸œè¥¿ï¼Œåœ¨ä½¿ç”¨å®Œåå°±ä¼šè¢«é‡Šæ”¾æ‰ï¼Œç„¶è€Œè¿™é‡ŒæŠŠä»–ä½œä¸ºè¿”å›å€¼è¿”å›å°±ä¼šé€ æˆæ‚¬å‚æŒ‡é’ˆçš„å‡ºç°ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦è¿”å›ä¸€ä¸ªæ–°çš„ä¸œè¥¿å°±è¡Œäº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>no_dangle</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>no_dangle</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>String</span> <span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>s</span><span class=w>
</span><span class=w></span><span class=p>}</span></code></pre></td></tr></table></div></div><p>å­¦ä¹ åˆ°ç°åœ¨ï¼Œè¿™äº›ä¸œè¥¿éƒ½è¿˜æ˜¯èƒ½å¤Ÿç†è§£çš„ï¼Œéƒ½æ˜¯ä¸ºäº†è§£å†³åƒåœ¾å›æ”¶å†…å­˜å®‰å…¨ç›¸å…³è€Œå‘æ˜çš„ç‰¹æ€§ã€‚</p><p>å®Œ!</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Joe</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-07-07</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/programing/>programing</a>
<a href=/tags/rust/>rust</a></div><nav class=post-nav><a class=prev href=/post/rust/rust-struct/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Rust Struct</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/rust/rust-ownership/><span class="next-text nav-default">Rust Function</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:longshanluu@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/holicc/holicc class="iconfont icon-github" title=github></a><a href=https://holicc.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Joe</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-157580785-1','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>